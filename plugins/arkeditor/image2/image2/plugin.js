"use strict";
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
(function(){function s(n){function e(){this.deflated||(n.widgets.focused==this.widget&&(this.focused=!0),n.widgets.destroy(this.widget),this.deflated=!0)}function o(){var r=n.editable(),u=n.document,i;this.deflated?(this.widget=n.widgets.initOn(this.element,"image",this.widget.data),this.widget.inline&&!new CKEDITOR.dom.elementPath(this.widget.wrapper,r).block&&(i=u.createElement(n.activeEnterMode==CKEDITOR.ENTER_P?"p":"div"),i.replace(this.widget.wrapper),this.widget.wrapper.move(i)),this.focused&&(this.widget.focus(),delete this.focused),delete this.deflated):h(this.widget,t)}var t=n.config.image2_alignClasses,i=n.config.image2_captionedClass;return{allowedContent:w(n),requiredContent:"img[src,alt]",features:b(n),styleableElements:"img figure",contentTransformations:[["img[width]: sizeToAttribute"]],editables:{caption:{selector:"figcaption",allowedContent:"br em strong sub sup u s; a[!href,target]"}},parts:{image:"img",caption:"figcaption"},dialog:"image2",template:f,data:function(){var t=this.features,i;if(this.data.hasCaption&&!n.filter.checkFeature(t.caption)&&(this.data.hasCaption=!1),this.data.align=="none"||n.filter.checkFeature(t.align)||(this.data.align="none"),this.shiftState({widget:this,element:this.element,oldData:this.oldData,newData:this.data,deflate:e,inflate:o}),this.data.link?this.parts.link||(this.parts.link=this.parts.image.getParent()):this.parts.link&&delete this.parts.link,this.parts.image.setAttributes({src:this.data.src,"data-cke-saved-src":this.data.src,alt:this.data.alt}),this.oldData&&!this.oldData.hasCaption&&this.data.hasCaption)for(i in this.data.classes)this.parts.image.removeClass(i);n.filter.checkFeature(t.dimension)&&a(this);this.oldData=CKEDITOR.tools.extend({},this.data)},init:function(){var o=CKEDITOR.plugins.image2,r=this.parts.image,i={hasCaption:!!this.parts.caption,src:r.getAttribute("src"),alt:r.getAttribute("alt")||"",width:r.getAttribute("width")||"",height:r.getAttribute("height")||"",lock:this.ready?o.checkHasNaturalRatio(r):!0},s=r.getAscendant("a"),f,e;s&&this.wrapper.contains(s)&&(this.parts.link=s);i.align||(f=i.hasCaption?this.element:r,t?(f.hasClass(t[0])?i.align="left":f.hasClass(t[2])&&(i.align="right"),i.align?f.removeClass(t[u[i.align]]):i.align="none"):(i.align=f.getStyle("float")||"none",f.removeStyle("float")));n.plugins.link&&this.parts.link&&(i.link=o.getLinkAttributesParser()(n,this.parts.link),e=i.link.advanced,e&&e.advCSSClasses&&(e.advCSSClasses=CKEDITOR.tools.trim(e.advCSSClasses.replace(/cke_\S+/,""))));this.wrapper[(i.hasCaption?"remove":"add")+"Class"]("cke_image_nocaption");this.setData(i);n.filter.checkFeature(this.features.dimension)&&n.config.image2_disableResizer!==!0&&v(this);this.shiftState=o.stateShifter(this.editor);this.on("contextMenu",function(n){n.data.image=CKEDITOR.TRISTATE_OFF;(this.parts.link||this.wrapper.getAscendant("a"))&&(n.data.link=n.data.unlink=CKEDITOR.TRISTATE_OFF)});this.on("dialog",function(n){n.data.widget=this},this);n.on("blur",function(){},null,null,8);n.on("saveContent",function(){},null,null,9)},addClass:function(n){r(this).addClass(n)},hasClass:function(n){return r(this).hasClass(n)},removeClass:function(n){r(this).removeClass(n)},getClasses:function(){var n=new RegExp("^("+[].concat(i,t).join("|")+")$");return function(){var t=this.repository.parseElementClasses(r(this).getAttribute("class"));for(var i in t)n.test(i)&&delete t[i];return t}}(),upcast:c(n),downcast:l(n),getLabel:function(){var n=(this.data.alt||"")+" "+this.pathName;return this.editor.lang.widget.label.replace(/%1/,n)}}}function h(n,t){var i=n.wrapper,r=n.data.align,e=n.data.hasCaption,f;if(t){for(f=3;f--;)i.removeClass(t[f]);r=="center"?e&&i.addClass(t[1]):r!="none"&&i.addClass(t[u[r]])}else r=="center"?(e?i.setStyle("text-align","center"):i.removeStyle("text-align"),i.removeStyle("float")):(r=="none"?i.removeStyle("float"):i.setStyle("float",r),i.removeStyle("text-align"))}function c(n){var r=i(n),u=n.config.image2_captionedClass;return function(i,f){var a=i.name,e,s,c,l,h;if(!i.attributes["data-cke-realelement"]&&(r(i)?(a=="div"&&(s=i.getFirst("figure"),s&&(i.replaceWith(s),i=s)),f.align="center",e=i.getFirst("img")||i.getFirst("a").getFirst("img")):a=="figure"&&i.hasClass(u)?e=i.find(function(n){return n.name==="img"&&CKEDITOR.tools.array.indexOf(["figure","a"],n.parent.name)!==-1},!0)[0]:t(i)&&(e=i.name=="a"?i.children[0]:i),e)){for(c in{width:1,height:1})l=e.attributes[c],l&&l.match(o)&&delete e.attributes[c];return n.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&n.config.sefEnabled&&(h=e.attributes.src,h=h.replace(/^(?!\/|[a-zA-Z0-9\-]+:|#|')(.*)$/i,n.config.base+"$1"),e.attributes.src=h),i}}}function l(n){var r=n.config.image2_alignClasses,f=i(n);return function(i){var a=i.name=="a"?i.getFirst():i,v=a.attributes,s=this.data.align,c,o,e,h,l;return this.inline||(c=i.getFirst("span"),c&&c.replaceWith(c.getFirst({img:1,a:1}))),s&&s!="none"&&(e=CKEDITOR.tools.parseCssText(v.style||""),s=="center"&&i.name=="figure"?i=i.wrapWith(new CKEDITOR.htmlParser.element("div",r?{"class":r[1]}:{style:"text-align:center"})):s in{left:1,right:1}&&(r?a.addClass(r[u[s]]):e.float=s),r||CKEDITOR.tools.isEmpty(e)||(v.style=CKEDITOR.tools.writeCssText(e))),this.inline&&(f(i)?o=i.getFirst("img")||i.getFirst("a").getFirst("img"):t(i)&&(o=i.name=="a"?i.children[0]:i),e=o.attributes.style,h=this.wrapper,e&&(h.getStyle("float")&&(e=e.trim().replace(new RegExp("^float\\s*:\\s*(?:\\w+)(?:;+|$)"),""),e=e.trim().replace(new RegExp(";\\s*float\\s*:\\s*(?:\\w+)(?:;+|$)"),";")),h.getStyle("width")&&(e=e.trim().replace(new RegExp("^\\s*width\\s*:\\s*(?:[a-z0-9_\\-\\(\\)% ]+)(?:;+|$)"),""),e=e.trim().replace(new RegExp(";\\s*width\\s*:\\s*(?:[a-z0-9_\\-\\(\\)% ]+)(?:;+|$)"),";")),h.getStyle("max-width")&&(e=e.trim().replace(new RegExp("^\\s*max-width\\s*:\\s*(?:\\w+%?)(?:;+|$)"),""),e=e.trim().replace(new RegExp(";\\s*max-width\\s*:\\s*(?:\\w+%?)(?:;+|$)"),";")),h.getStyle("margin-right")&&(e=e.trim().replace(new RegExp("^\\s*margin-right\\s*:\\s*(?:\\w+%?)(?:;+|$)"),""),e=e.trim().replace(new RegExp(";\\s*margin-right\\s*:\\s*(?:\\w+%?)(?:;+|$)"),";")),h.getStyle("margin-left")&&(e=e.trim().replace(new RegExp("^\\s*margin-left\\s*:\\s*(?:\\w+%?)(?:;+|$)"),""),e=e.trim().replace(new RegExp(";\\s*margin-left\\s*:\\s*(?:\\w+%?)(?:;+|$)"),";")),o.attributes["data-image-float"]&&(e=e.trim()+";float: "+o.attributes["data-image-float"],delete o.attributes["data-image-float"]),o.attributes["data-image-width"]&&(e=e.trim()+";width: "+o.attributes["data-image-width"],delete o.attributes["data-image-width"]),o.attributes["data-image-maxwidth"]&&(e=e.trim()+";max-width: "+o.attributes["data-image-maxwidth"],delete o.attributes["data-image-maxwidth"]),o.attributes["data-image-marginright"]&&(e=e.trim()+";margin-right: "+o.attributes["data-image-marginright"],delete o.attributes["data-image-marginright"]),o.attributes["data-image-marginleft"]&&(e=e.trim()+";margin-left: "+o.attributes["data-image-marginleft"],delete o.attributes["data-image-marginleft"]),e?o.attributes.style=e.replace(/^;+/,"").replace(/;;/g,";"):delete o.attributes.style),delete o.attributes["data-image-widget-flowlayout"]),n.elementMode==CKEDITOR.ELEMENT_MODE_INLINE&&n.config.sefEnabled&&(o||(f(i)?o=i.getFirst("img")||i.getFirst("a").getFirst("img"):i.name=="figure"&&i.hasClass(captionedClass)?o=i.getFirst("img")||i.getFirst("a").getFirst("img"):t(i)&&(o=i.name=="a"?i.children[0]:i)),o&&(l=o.attributes.src,l=l.replace(n.config.base,""),o.attributes.src=l)),i}}function i(n){var r=n.config.image2_captionedClass,i=n.config.image2_alignClasses,u={figure:1,a:1,img:1};return function(f){var o,e;if(!(f.name in{div:1,p:1})||(o=f.children,o.length!==1)||(e=o[0],!(e.name in u)))return!1;if(f.name=="p"){if(!t(e))return!1}else if(e.name=="figure"){if(!e.hasClass(r))return!1}else if(n.enterMode==CKEDITOR.ENTER_P||!t(e))return!1;return(i?f.hasClass(i[1]):CKEDITOR.tools.parseCssText(f.attributes.style||"",!0)["text-align"]=="center")?!0:!1}}function t(n){return n.name=="img"?!0:n.name=="a"?n.children.length==1&&n.getFirst("img"):!1}function a(n){var r=n.data,i={width:r.width,height:r.height},u=n.parts.image;for(var t in i)i[t]?u.setAttribute(t,i[t]):u.removeAttribute(t)}function v(n){var i=n.editor,f=i.editable(),r=i.document,t=n.resizer=r.createElement("span");if(t.addClass("cke_image_resizer"),t.setAttribute("title",i.lang.image2.resizer),t.append(new CKEDITOR.dom.text("â€‹",r)),n.inline)n.wrapper.append(t);else{var e=n.parts.link||n.parts.image,o=e.getParent(),u=r.createElement("span");u.addClass("cke_image_resizer_wrapper");u.append(e);u.append(t);n.element.append(u,!0);o.is("span")&&o.remove()}t.on("mousedown",function(u){function rt(n,t,i){var f=CKEDITOR.document,u=[],e;if(r.equals(f)||u.push(f.on(n,t)),u.push(r.on(n,t)),i)for(e=u.length;e--;)i.push(u.pop())}function s(){c=nt+k*v;l=Math.round(c/o)}function h(){l=tt-e;c=Math.round(l*o)}function et(n){g=n.data.$;v=g.screenX-ut;e=ft-g.screenY;y=Math.abs(v/e);k==1?v<=0?e<=0?s():y>=o?s():h():e<=0?y>=o?h():s():h():v<=0?e<=0?y>=o?h():s():h():e<=0?s():y>=o?s():h();ht(c,l)&&(a={width:c,height:l},p.setAttributes(a))}function ot(){for(var r;r=d.pop();)r.removeListener();f.removeClass(it);t.removeClass("cke_image_resizing");a&&(n.setData(a),i.fire("saveSnapshot"));a=!1}function st(){var n=i.config.image2_maxSize,t;return n?(n=CKEDITOR.tools.copy(n),t=CKEDITOR.plugins.image2.getNatural(p),n.width=Math.max(n.width==="natural"?t.width:n.width,w.width),n.height=Math.max(n.height==="natural"?t.height:n.height,w.width),n):null}function ht(n,t){var i=n<w.width||t<w.height,r=b&&(n>b.width||t>b.height);return!i&&!r}var p=n.parts.image,w={width:15,height:15},b=st(),k=n.data.align=="right"?-1:1,ut=u.data.$.screenX,ft=u.data.$.screenY,nt=p.$.clientWidth,tt=p.$.clientHeight,o=nt/tt,d=[],it="cke_image_s"+(~k?"e":"w"),g,c,l,a,v,e,y;i.fire("saveSnapshot");rt("mousemove",et,d);rt("mouseup",ot,d);f.addClass(it);t.addClass("cke_image_resizing")});n.on("data",function(){t[n.data.align=="right"?"addClass":"removeClass"]("cke_image_resizer_left")})}function y(t){var i=[],r;return function(u){var f=t.getCommand("justify"+u);if(f){if(i.push(function(){f.refresh(t,t.elementPath())}),u in{right:1,left:1,center:1})f.on("exec",function(r){var e=n(t),f;if(e){for(e.setData("align",u),f=i.length;f--;)i[f]();r.cancel()}});f.on("refresh",function(i){var f=n(t);f&&(r===undefined&&(r=t.filter.checkFeature(t.widgets.registered.image.features.align)),r?this.setState(f.data.align==u?CKEDITOR.TRISTATE_ON:u in{right:1,left:1,center:1}?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED):this.setState(CKEDITOR.TRISTATE_DISABLED),i.cancel())})}}}function p(t){if(t.plugins.link){var i=CKEDITOR.on("dialogDefinition",function(i){var u=i.data;if(u.name=="link"){var r=u.definition,f=r.onShow,e=r.onOk;r.onShow=function(){var i=n(t),r=this.getContentElement("info","linkDisplayText").getElement().getParent().getParent();i&&(i.inline?!i.wrapper.getAscendant("a"):1)?(this.setupContent(i.data.link||{}),r.hide()):(r.show(),f.apply(this,arguments))};r.onOk=function(){var i=n(t),r;i&&(i.inline?!i.wrapper.getAscendant("a"):1)?(r={},this.commitContent(r),i.setData("link",r)):e.apply(this,arguments)}}});t.on("destroy",function(){i.removeListener()});t.getCommand("unlink").on("exec",function(i){var r=n(t);r&&r.parts.link&&(r.setData("link",null),this.refresh(t,t.elementPath()),i.cancel())});t.getCommand("unlink").on("refresh",function(i){var r=n(t);r&&(this.setState(r.data.link||r.wrapper.getAscendant("a")?CKEDITOR.TRISTATE_OFF:CKEDITOR.TRISTATE_DISABLED),i.cancel())})}}function n(n){var t=n.widgets.focused;return t&&t.name=="image"?t:null}function w(n){var r=n.config.image2_alignClasses,t={div:{match:i(n)},p:{match:i(n)},img:{attributes:"!src,alt,width,height"},figure:{classes:"!"+n.config.image2_captionedClass},figcaption:!0};return r?(t.div.classes=r[1],t.p.classes=t.div.classes,t.img.classes=r[0]+","+r[2],t.figure.classes+=","+t.img.classes):(t.div.styles="text-align",t.p.styles="text-align",t.img.styles="float",t.figure.styles="float,display"),t}function b(n){var t=n.config.image2_alignClasses;return{dimension:{requiredContent:"img[width,height]"},align:{requiredContent:"img"+(t?"("+t[0]+")":"{float}")},caption:{requiredContent:"figcaption"}}}function r(n){return n.data.hasCaption?n.element:n.parts.image}var f='<img alt="" src="" />',e=new CKEDITOR.template('<figure class="{captionedClass}">'+f+"<figcaption>{captionPlaceholder}<\/figcaption><\/figure>"),u={left:0,center:1,right:2},o=/^\s*(\d+\%)\s*$/i;CKEDITOR.plugins.add("image2",{lang:"en,en-gb,de,es,fi,fr,he,hu,it,pt,nl,ru,zh-cn",requires:"widget,dialog",icons:"image",hidpi:!0,onLoad:function(){CKEDITOR.addCss('.cke_image_nocaption{line-height:0}.cke_editable.cke_image_sw, .cke_editable.cke_image_sw *{cursor:sw-resize !important}.cke_editable.cke_image_se, .cke_editable.cke_image_se *{cursor:se-resize !important}.cke_image_resizer{display:none;position:absolute;width:10px;height:10px;bottom:-5px;right:-5px;background:#000;outline:1px solid #fff;line-height:0;cursor:se-resize;}.cke_image_resizer_wrapper{position:relative;display:inline-block;line-height:0;}.cke_image_resizer.cke_image_resizer_left{right:auto;left:-5px;cursor:sw-resize;}.cke_widget_wrapper:hover .cke_image_resizer,.cke_image_resizer.cke_image_resizing{display:block}.cke_editable[contenteditable="false"] .cke_image_resizer{display:none;}.cke_widget_wrapper>a{display:inline-block}')},init:function(n){if(!n.plugins.detectConflict("image2",["easyimage"])){var t=n.config,i=n.lang.image2,r=s(n);t.filebrowserImage2BrowseUrl=t.filebrowserImageBrowseUrl;t.filebrowserImage2UploadUrl=t.filebrowserImageUploadUrl;r.pathName=i.pathName;r.editables.caption.pathName=i.pathNameCaption;n.widgets.add("image",r);n.ui.addButton&&n.ui.addButton("Image",{label:n.lang.common.image,command:"image",toolbar:"insert,10"});n.contextMenu&&(n.addMenuGroup("image",10),n.addMenuItem("image",{label:i.menu,command:"image",group:"image"}));CKEDITOR.dialog.add("image2",this.path+"dialogs/image2.js")}},afterInit:function(n){var t=y(n);for(var i in{left:1,right:1,center:1,block:1})t(i);p(n);n.widgets.on("instanceCreated",function(n){var t=n.data;if(t.name=="image"&&t.inline)t.once("ready",function(){var t=this.wrapper,n=this.parts.image,i,r;n.data("image-widget-flowlayout")&&(n.data("image-float")?(n.setStyle("float",n.data("image-float")),n.data("image-float",!1)):n.removeStyle("float"),n.data("image-width")?(n.setStyle("width",n.data("image-width")),n.data("image-width",!1)):n.removeStyle("width"),n.data("image-maxwidth")?(n.setStyle("max-width",n.data("image-maxwidth")),n.data("image-maxwidth",!1)):n.removeStyle("max-width"),n.data("image-marginright")?(n.setStyle("margin-right",n.data("image-marginright")),n.data("image-marginright",!1)):n.removeStyle("margin-right"),n.data("image-marginleft")?(n.setStyle("margin-left",n.data("image-marginleft")),n.data("image-marginleft",!1)):n.removeStyle("margin-left"));var o=n.getStyle("display"),s=n.getStyle("width"),h=n.getStyle("float"),c=n.getStyle("max-width"),u=n.getStyle("margin-right"),f=n.getStyle("margin-left");n.setStyle("display","none");var l=n.getComputedStyle("float"),a=n.getComputedStyle("width"),e=n.getComputedStyle("max-width"),y=t.getParent().getComputedStyle("display"),v=t.getParent().getComputedStyle("max-width");n.removeStyle("display");o&&n.setStyle("display",o);n.data("image-widget-flowlayout",!0);l!="none"&&(n.setStyle("float","none"),h&&n.data("image-float",h),t.setStyle("float",l));a.match(/%$/)?(i=n.getComputedStyle("margin-right")||0,r=n.getComputedStyle("margin-left")||0,n.setStyle("width","100%"),i&&(n.setStyle("margin-right","0px"),t.setStyle("margin-right",i),u&&n.data("image-marginright",u)),r&&(n.setStyle("margin-left","0px"),t.setStyle("margin-left",r),f&&n.data("image-marginleft",f)),s&&n.data("image-width",s),c&&n.data("image-maxwidth",c),e&&e!="none"&&(n.setStyle("max-width","100%"),t.setStyle("max-width",e)),t.setStyle("width",a)):y=="flex"&&v&&v!="none"&&(i=n.getComputedStyle("margin-right")||0,r=n.getComputedStyle("margin-left")||0,i&&(n.setStyle("margin-right","0px"),t.setStyle("margin-right",i),u&&n.data("image-marginright",u)),r&&(n.setStyle("margin-left","0px"),t.setStyle("margin-left",r),f&&n.data("image-marginleft",f)))})})}});CKEDITOR.plugins.image2={stateShifter:function(n){function u(n,t){var e={},u;return r?e.attributes={"class":r[1]}:e.styles={"text-align":"center"},u=i.createElement(n.activeEnterMode==CKEDITOR.ENTER_P?"p":"div",e),f(u,t),t.move(u),u}function c(n){var t=n.findOne("a,img");return t.replace(n),t}function l(n,t){var r=i.createElement("a",{attributes:{href:t.url}});return r.replace(n),n.move(r),r}function a(n){var t=n.findOne("img");return t.replace(n),t}function f(t,i){if(i.getParent()){var r=n.createRange();r.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START);i.remove();s.insertElementIntoRange(t,r)}else t.replace(i)}var i=n.document,r=n.config.image2_alignClasses,o=n.config.image2_captionedClass,s=n.editable(),t=["hasCaption","align","link"],h={align:function(t,i,f){var e=t.element;t.changed.align?t.newData.hasCaption||(f=="center"&&(t.deflate(),t.element=u(n,e)),t.changed.hasCaption||i!="center"||f=="center"||(t.deflate(),t.element=c(e))):f=="center"&&t.changed.hasCaption&&!t.newData.hasCaption&&(t.deflate(),t.element=u(n,e));!r&&e.is("figure")&&(f=="center"?e.setStyle("display","inline-block"):e.removeStyle("display"))},hasCaption:function(t,r,u){var s,h;t.changed.hasCaption&&(s=t.element.is({img:1,a:1})?t.element:t.element.findOne("a,img"),t.deflate(),u?(h=CKEDITOR.dom.element.createFromHtml(e.output({captionedClass:o,captionPlaceholder:n.lang.image2.captionPlaceholder}),i),f(h,t.element),s.replace(h.findOne("img")),t.element=h):(s.replace(t.element),t.element=s))},link:function(t,i,r){var f;if(t.changed.link){var s=t.element.is("img")?t.element:t.element.findOne("img"),e=t.element.is("a")?t.element:t.element.findOne("a"),o=t.element.is("a")&&!r||t.element.is("img")&&r,u;o&&t.deflate();r?(i||(u=l(s,t.newData.link)),f=CKEDITOR.plugins.image2.getLinkAttributesGetter()(n,r),CKEDITOR.tools.isEmpty(f.set)||(u||e).setAttributes(f.set),f.removed.length&&(u||e).removeAttributes(f.removed)):u=a(e);o&&(t.element=u)}}};return function(n){var i,r;for(n.changed={},r=0;r<t.length;r++)i=t[r],n.changed[i]=n.oldData?n.oldData[i]!==n.newData[i]:!1;for(r=0;r<t.length;r++)i=t[r],h[i](n,n.oldData?n.oldData[i]:null,n.newData[i]);n.inflate()}},checkHasNaturalRatio:function(n){var t=n.$,i=this.getNatural(n);return Math.round(t.clientWidth/i.width*i.height)==t.clientHeight||Math.round(t.clientHeight/i.height*i.width)==t.clientWidth},getNatural:function(n){var i,t;return n.$.naturalWidth?i={width:n.$.naturalWidth,height:n.$.naturalHeight}:(t=new Image,t.src=n.getAttribute("src"),i={width:t.width,height:t.height}),i},getLinkAttributesGetter:function(){return CKEDITOR.plugins.link.getLinkAttributes},getLinkAttributesParser:function(){return CKEDITOR.plugins.link.parseLinkAttributes}}})();CKEDITOR.config.image2_captionedClass="image"